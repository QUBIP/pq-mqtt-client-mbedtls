/**
 * @file  demo_mlkem.c
 * @brief Validation Test for MLKEM Code
 *
 * @section License
 *
 * Secure Element for QUBIP Project
 *
 * This Secure Element repository for QUBIP Project is subject to the
 * BSD 3-Clause License below.
 *
 * Copyright (c) 2024,
 *         Eros Camacho-Ruiz
 *         Pablo Navarro-Torrero
 *         Pau Ortega-Castro
 *         Apurba Karmakar
 *         Macarena C. Martínez-Rodríguez
 *         Piedad Brox
 *
 * All rights reserved.
 *
 * This Secure Element was developed by Instituto de Microelectrónica de
 * Sevilla - IMSE (CSIC/US) as part of the QUBIP Project, co-funded by the
 * European Union under the Horizon Europe framework programme
 * [grant agreement no. 101119746].
 *
 * -----------------------------------------------------------------------
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * 3. Neither the name of the copyright holder nor the names of its
 *    contributors may be used to endorse or promote products derived from
 *    this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 *
 *
 *
 * @author Eros Camacho-Ruiz (camacho@imse-cnm.csic.es)
 * @version 1.0
 **/

#include "demo.h"
#include "test_func.h"

/*


 count = 31
 seed = AD540A9CE816D6FB1661E5483C44F6FDD00C9E7BD1A8CEDA4B4C4D3697D4F78ED0A56954996CCB7DA96ECB8F5CB15809
 pk = B30C011788CB97CB439789A67D476D3DD265CAE63CBE43CB63AA124B93071D6812BC662F346481F974A73B16A505C48B9608359A3C035135258029A18B0217461830785379D3355FF3968D3C63A46685902425660B232B11B93997E60AE0A5BB95A27D553081F393040B1C30EC87535FFC6FE528B1E9866CD1E69520E376E0071087748691DCC057B95CD4C60707D8B976D6A67AF4869D960D5466A9F3251DDE92CFE8A0B03EA2C43BF03FABC9C9B5D97EA2F558B2BC0EC1908335CA4F2607CB04380A830B245F8B43FD06098269BF9CE33FC07C1E68A05F63560D70544EEA4C0BC528859A5B09683B8B3D3C6842E6458061B7DDC4B23EC6AE83D557E5C4B1848445FE253B35E52102517CD38030E6EA28A5E1A24BD09AC6B83C5DC658D11589900A7BB09A963480A2D76225AE55BC54108FB233785174B375A184EBA110E05762E7F26139DCA4CB197620156C06E47E5B74A0970BC6E18B1E1C919A6C0B10E7470D5CE09E2719194DA0440AC3AACD86BF724AA841A83DCF64C8E1F7704397A4CD57BBABC9A0CF940E97E8921211006044228632382EF48FB5D3B65219A5A6983AD0E48EE39081F2BA1103BC9C6314090A31AA34213C0C319EEAD96B865CBC98327570B965BF00CB9BAC18C640273D342CEDD11D72E2078399C458068439A8A27E388D3F4BB285B63992B5A4354122AC298222E39D31CB886C4958F28C5C2F37384632B4DB216B43CA6246051FD704B5969C07DBD525AC6A479E730F8B11C5D41111AC65764FD71A4F43BE55C563CEE5C26C69CDAA485D850C2126F2BB16F5766FE86BCE17535198CE99C2A66918AF96641B2EC74BE2B61752076A2DB330984CCD7021CE360A0C488143648389F492BA20AC566CF401383A496991497208B760D36DA6896BB3587788597191C3347539BE92B78CC6A2B0D8EB4188320CEB8AA6EE1018E9F78F4F8097AE7527EC947CB1B27DC8A86EE200020127531273983BF66746A7B731464A6B1524B18744A8C606648B2FB1A4339D5A15D7F6A5EA3A1C08122B773AB09564792FBA2E28719A603C3ED0850F2D5045DE3BB93DDA7A84E692C25537EF695787FB0889107395F87C6B836E138BBA9F4A711DAA421A396F556C26E3778F4D364D5B1844118B367D78AF37836FD7A9637F1714CD9A3E52155B0047468B5420CD5C6BB64138BA16863E18B4368542800B378537B5CF303CD2B191CCF783719142FFAC1AD0585B1938281CEB5C86587C43B28C49D9111982BA7AC567E1FB64D8E3C450730305CC2E4E12CC698A728977CF1C9B373F051C17F1935177AE90AA8856A5A24D18A08AA942B4250A6447C35289CF0B334AF45647E21B5A2153A8A05A38AC4C728A3350A15502CBA347A876CC4BD12034935BB3DC14435930D912AAC8A787DB3CA33521637C5159B015920100B416D22C18D6A0A52612C7D75C15741B6954AE752C4D31FBAF1B483B6B6862E6A983D5465E3B7B80E1654FACA5C669E77295F86263D344031B5EA7AB99E714C0A821042BD9512677AB9E89309F41CF47944DA1801521402F211A6076490AE393818EA2056954B24A624E6E54ACB7D5BBB32C14B339730AF6A72647A66F761BBB78012A76540763CB29DCB9B8C27A3C1E43769C31AF3EF54F7C8062D713CAB3803437E759A01EE76FBA1A5B
 sk = B141B7D0D3C420B8548EBA8E71F2A751882023A2938A0628FEA97EACC45BD2FA0E89F485E57355E9C58B57746519E2538060924D9032508A508A8A36382254B5880E77248C6734C7F841C309830CE19898233116C0482888C03378B5946EB53E4A59B190B62DBBA173D4297405F9CD189C76FBAB0786FAC8A0E90EB3E8AD689726B1F8B321175094260775E143CFEA2C22A5AAEC749E7C7002CFE8AB16345ADAE43B6CA04BDC21632F799C77DA62755184C51B3535830277D83ED07574FF8A478C06A7DC817AFEF2684C00784865116FB8755CF13D19750E01AA165132C2844C1D27409D975BB2B0C97FFC7222DB3B13D47C8A5EE20DD147307BDC65B3AB91BD6481E17686D2F1534C0C73FB633260930A92C25ADEBC2BBD1299185439D0811EA303551E0879D825CCB08B7E307BA37B843854215EBCCA1EBA3237D95080C317979DA65172146645A543BA045F13851781028669C9B4CCC217D5BA8585A1495D652DD89B402C87043E285D3B0C72EAC388960367A428BD3E7A903FFBBD83614DF2B33180843375F1C9AF398975FACA439B0A15B2BCF804C340176400D1B80E399597372B53380DF0C61AC2F0A1757616825C8A3F90CF227CA44FC88E8608162232B1B5B882017843A6B61AF95193B6375951CA70ADE7A525633C75333450CBB38338A493099990080D99A788426047426CC89146B4AFE079FEC981884A4BB1A27931074A88BC9BC1271C40F2A8B6A1BC0CA4A24D71024BC7ACC077B97CC47531D21DE9F94FA8DBC522F78F698C77078788F6D90F67A661095B942CC5A349076E79EA90139CBF9C2216CA4C704F9992FB7A213C0B97D2BC5FC3491A6CD3BC599C9EB4D1469C3A3EFC14B7C6020C4A85481CD86D8C2B2F51410AB1CCCD55458BAD9422BAE77C1D544CC52C94D0D22D2E9783165548BAF519BD05B4909626DA8991FB48CB82B0C3A25B34F3C57A537039DBA031857B40023B6AB8BAA64B5234DC5403BDF3AA647CA09BEC6F32148E99DB47C7D141EDC70C804B722559CAA7214184BA97BA9802A7604604E90510295B21204B22955402EA572A12122205ADE2D1524E57B85ACACEB767086EE1218FD51F4799BE7364137B364DD2F832E8731605C9C69F4848B3237B51AC791D4A5A3ECAA5EDD29DE90412CA62C5556A6389EC98948735E162745F383C9C59A99764583D19C72255454B568B908A0E0828B7DD235DBF2268416C1BE640289606609F0122C0B492169954CF201A7D654E21541EEBE5448B0175D9B10314397A6632865CFCC055E566B476BE03773781B35842B6583105200E1CAD7475BF95355268AA1CFB1C7C16A68D2C38B92B6841C0B545C5E972DD7794110B5D34CBAFC9678E66D100AB1C6A1E0B5C262148F730762086BB7FD017AEA3069EF76C71C110DB4C80CB2C4FDC8C779486223920731906CB4553A00A400A3878AFA709079354A7F3E3795AE77698668FAB278688F3B21558306EE6844801B625B017203AB715D110FD636F4FA3C2C3C56ED43879468C9CCA379D3CC77197908C54875B0AB7B35EC8B774B5AD15D3CA75291B1CEB201A959B57215657606DBC9B8F1C124EB8A57C6146B1931C019A0A94EA266F441B6520B199161877B30C011788CB97CB439789A67D476D3DD265CAE63CBE43CB63AA124B93071D6812BC662F346481F974A73B16A505C48B9608359A3C035135258029A18B0217461830785379D3355FF3968D3C63A46685902425660B232B11B93997E60AE0A5BB95A27D553081F393040B1C30EC87535FFC6FE528B1E9866CD1E69520E376E0071087748691DCC057B95CD4C60707D8B976D6A67AF4869D960D5466A9F3251DDE92CFE8A0B03EA2C43BF03FABC9C9B5D97EA2F558B2BC0EC1908335CA4F2607CB04380A830B245F8B43FD06098269BF9CE33FC07C1E68A05F63560D70544EEA4C0BC528859A5B09683B8B3D3C6842E6458061B7DDC4B23EC6AE83D557E5C4B1848445FE253B35E52102517CD38030E6EA28A5E1A24BD09AC6B83C5DC658D11589900A7BB09A963480A2D76225AE55BC54108FB233785174B375A184EBA110E05762E7F26139DCA4CB197620156C06E47E5B74A0970BC6E18B1E1C919A6C0B10E7470D5CE09E2719194DA0440AC3AACD86BF724AA841A83DCF64C8E1F7704397A4CD57BBABC9A0CF940E97E8921211006044228632382EF48FB5D3B65219A5A6983AD0E48EE39081F2BA1103BC9C6314090A31AA34213C0C319EEAD96B865CBC98327570B965BF00CB9BAC18C640273D342CEDD11D72E2078399C458068439A8A27E388D3F4BB285B63992B5A4354122AC298222E39D31CB886C4958F28C5C2F37384632B4DB216B43CA6246051FD704B5969C07DBD525AC6A479E730F8B11C5D41111AC65764FD71A4F43BE55C563CEE5C26C69CDAA485D850C2126F2BB16F5766FE86BCE17535198CE99C2A66918AF96641B2EC74BE2B61752076A2DB330984CCD7021CE360A0C488143648389F492BA20AC566CF401383A496991497208B760D36DA6896BB3587788597191C3347539BE92B78CC6A2B0D8EB4188320CEB8AA6EE1018E9F78F4F8097AE7527EC947CB1B27DC8A86EE200020127531273983BF66746A7B731464A6B1524B18744A8C606648B2FB1A4339D5A15D7F6A5EA3A1C08122B773AB09564792FBA2E28719A603C3ED0850F2D5045DE3BB93DDA7A84E692C25537EF695787FB0889107395F87C6B836E138BBA9F4A711DAA421A396F556C26E3778F4D364D5B1844118B367D78AF37836FD7A9637F1714CD9A3E52155B0047468B5420CD5C6BB64138BA16863E18B4368542800B378537B5CF303CD2B191CCF783719142FFAC1AD0585B1938281CEB5C86587C43B28C49D9111982BA7AC567E1FB64D8E3C450730305CC2E4E12CC698A728977CF1C9B373F051C17F1935177AE90AA8856A5A24D18A08AA942B4250A6447C35289CF0B334AF45647E21B5A2153A8A05A38AC4C728A3350A15502CBA347A876CC4BD12034935BB3DC14435930D912AAC8A787DB3CA33521637C5159B015920100B416D22C18D6A0A52612C7D75C15741B6954AE752C4D31FBAF1B483B6B6862E6A983D5465E3B7B80E1654FACA5C669E77295F86263D344031B5EA7AB99E714C0A821042BD9512677AB9E89309F41CF47944DA1801521402F211A6076490AE393818EA2056954B24A624E6E54ACB7D5BBB32C14B339730AF6A72647A66F761BBB78012A76540763CB29DCB9B8C27A3C1E43769C31AF3EF54F7C8062D713CAB3803437E759A01EE76FBA1A5B21916DFE025B78FC6D4DD1D1541B51CD3EECCA90AE52177431B33C708FAF17B5195927B10C3BE5F19FB055A71CF9610FDC0F03E23FD09EEB8C63B7BA3C0FE642
 ct = 3A6003C5A8F40554A2F6B0C1ED3C5BA71C55D519AA725B7155375787AA6BD8C678ED3690CD1D98A31F5DB575A49ED42A3A88BA0F8E1145717F8DCA3ED89CB46386AA93D062C1379B300A68CFE35B189D8930958939ABE0A97C5103883E78DD43F27378EE8057E31FF0B4AAA4B5A095D9150636192A0D1195B37253602F3C7606BB4D3D0B5F12CFC1B976B3A40C225CDFF6C3CC2CE6D8BB69E129ADB0A87720928796088793A7727D8FEABCA62352C4C0589FD8511E0EE205C1065C6A1BF8356E6FFE7DE39B003FAC98D2784B4652AD5D9BC2523EFB019D18C60997B5CC8D30D5CC83038196B958AAD5F3E483EC5FE8CE76A64982ADF6A262393B7DCA21151B72C09C8AB8DB9F1347A9D3F8E0E675ABE1D611C2BBB74C1AE8AE092085A4AF9D7859297D548A4EF61BF33F3599386D1DEB3E3AC10CED905A2A0A5F7AC4BB0419D477E1441D01696491CD56FB5CF5DD14D7B60AA9C70C2ECABBBDF3507931BA260101A358415109EDC44E51E7959A93D67AB59F5BDBB0A8501DB406F1DE26D8A58837012B6EFF5D31E46CECBD2FD23B4FD5A7F94EB9B6567C90C1326B7802A2C1D3DEEB3D12873662DA35AE0C90064E74630FE23217307EC07307C5CAFD698BFECB999E8419024BB2E72599D34FEA54232AA60135522D637ACC073B907B9586CDF985E2A85DBC371A2BD32CF7A095224D9228F50EC8F555C4D5CA3920D94CCEA742A28BFF374403AA44E6E5FCB0BA5D417E74657FFFB5D530F5C5E58224A9AEC01C913BE1F2CF3E6B15B2E33EE319C2A5997830E39FCA54A88D2246A02AB63911471E94CBDF7B90FAA1799F73E5AE47DC1989AC901B5AA62EAA12125C0A50B1603B277BF337261F581DED5A86A6ACAE3A27BA42214744172C058391E0AB85FEEC9EA5BE57F6A9DAD3E40FED6ADB11608326556925FF304AF0E599BA0DD766207688565621EC0AF3E020C72046C16BE1C40339070A4CAB3325BE80B731A58245161E3031B6A5D5BFBFF493F033B234AAA8E094D94E6DCEC52D35A8D7C4C308583B6CA9A080CE8147A93E0DD78897796DB56A0036ACA6681414136F06D8B32E34BD4C44C13B0177E0100C6558D0A22E58A1AB50545416501F311B313C1B7E484F716316B974DB1652C0F057D40F310B06800ECAAF0273F1263185F6D7F4F5262C61A171BEA2B4E848DB73E86AD4155CC2241E824CF28506298535E9B83EAE9F14B1F3A1D8749DE8AD3FDD057FC7805AA1AC0B552C4B5F8A31F713F6B9E9A8BD4B24F43230F772665829055418DBD6F64F4159D9FDDAFF441F2266CFCCDEA9BCB2042F579F2ACAC21811CFD3EA7D63E426BF82B3134C5C6D9A5B8B5AA0AFFB6C5BB4CC50CF15D6D100D7911C1826B639B91B2E4BE39B282DD9F582BC5844B73A1EC9EEBAC74470208C45FCFE88BAF53915BE1417BC134ACB915DDD3A9FDCEF8DF11C24500751C0E77A3810F8CD84D2FF06996A3423E8AA892103F39D294EA7D0F910DE7C73176FD70EB527500ED8E6F2771B0F813CB765C6D91791FD83E669CE33568B
 ss = E08749828B2041CA70C1960205987D9AFF49D374A4FF167CA00757D860DC2D23

 */

char *pk_s =
		"A72C2D9C843EE9F8313ECC7F86D6294D59159D9A879A542E260922ADF999051CC45200C9FFDB60449C49465979272367C083A7D6267A3ED7A7FD47957C219327F7CA73A4007E1627F00B11CC80573C15AEE6640FB8562DFA6B240CA0AD351AC4AC155B96C14C8AB13DD262CDFD51C4BB5572FD616553D17BDD430ACBEA3E95F0B698D66990AB51E5D03783A8B3D278A5720454CF9695CFDCA08485BA099C51CD92A7EA7587C1D15C28E609A81852601B0604010679AA482D51261EC36E36B8719676217FD74C54786488F4B4969C05A8BA27CA3A77CCE73B965923CA554E422B9B61F4754641608AC16C9B8587A32C1C5DD788F88B36B717A46965635DEB67F45B129B99070909C93EB80B42C2B3F3F70343A7CF37E8520E7BCFC416ACA4F18C7981262BA2BFC756AE03278F0EC66DC2057696824BA6769865A601D7148EF6F54E5AF5686AA2906F994CE38A5E0B938F239007003022C03392DF3401B1E4A3A7EBC6161449F73374C8B0140369343D9295FDF511845C4A46EBAAB6CA5492F6800B98C0CC803653A4B1D6E6AAED1932BACC5FEFAA818BA502859BA5494C5F5402C8536A9C4C1888150617F80098F6B2A99C39BC5DC7CF3B5900A21329AB59053ABAA64ED163E859A8B3B3CA3359B750CCC3E710C7AC43C8191CB5D68870C06391C0CB8AEC72B897AC6BE7FBAACC676ED66314C83630E89448C88A1DF04ACEB23ABF2E409EF333C622289C18A2134E650C45257E47475FA33AA537A5A8F7680214716C50D470E3284963CA64F54677AEC54B5272162BF52BC8142E1D4183FC017454A6B5A496831759064024745978CBD51A6CEDC8955DE4CC6D363670A47466E82BE5C23603A17BF22ACDB7CC984AF08C87E14E27753CF587A8EC3447E62C649E887A67C36C9CE98721B697213275646B194F36758673A8ED11284455AFC7A8529F69C97A3C2D7B8C636C0BA55614B768E624E712930F776169B01715725351BC74B47395ED52B25A1313C95164814C34C979CBDFAB85954662CAB485E75087A98CC74BB82CA2D1B5BF2803238480638C40E90B43C7460E7AA917F010151FAB1169987B372ABB59271F7006C24E60236B84B9DDD600623704254617FB498D89E58B0368BCB2103E79353EB587860C1422E476162E425BC2381DB82C6592737E1DD602864B0167A71EC1F223305C02FE25052AF2B3B5A55A0D7A2022D9A798DC0C5874A98702AAF4054C5D80338A5248B5B7BD09C53B5E2A084B047D277A861B1A73BB51488DE04EF573C85230A0470B73175C9FA50594F66A5F50B4150054C93B68186F8B5CBC49316C8548A642B2B36A1D454C7489AC33B2D2CE6668096782A2C1E0866D21A65E16B585E7AF8618BDF3184C1986878508917277B93E10706B1614972B2A94C7310FE9C708C231A1A8AC8D9314A529A97F469BF64962D820648443099A076D55D4CEA824A58304844F99497C10A25148618A315D72CA857D1B04D575B94F85C01D19BEF211BF0AA3362E7041FD16596D808E867B44C4C00D1CDA3418967717F147D0EB21B42AAEE74AC35D0B92414B958531AADF463EC6305AE5ECAF79174002F26DDECC813BF32672E8529D95A4E730A7AB4A3E8F8A8AF979A665EAFD465FC64A0C5F8F3F9003489415899D59A543D8208C54A3166529B53922";
char *sk_s =
		"07638FB69868F3D320E5862BD96933FEB311B362093C9B5D50170BCED43F1B536D9A204BB1F22695950BA1F2A9E8EB828B284488760B3FC84FABA04275D5628E39C5B2471374283C503299C0AB49B66B8BBB56A4186624F919A2BA59BB08D8551880C2BEFC4F87F25F59AB587A79C327D792D54C974A69262FF8A78938289E9A87B688B083E0595FE218B6BB1505941CE2E81A5A64C5AAC60417256985349EE47A52420A5F97477B7236AC76BC70E8288729287EE3E34A3DBC3683C0B7B10029FC203418537E7466BA6385A8FF301EE12708F82AAA1E380FC7A88F8F205AB7E88D7E95952A55BA20D09B79A47141D62BF6EB7DD307B08ECA13A5BC5F6B68581C6865B27BBCDDAB142F4B2CBFF488C8A22705FAA98A2B9EEA3530C76662335CC7EA3A00777725EBCCCD2A4636B2D9122FF3AB77123CE0883C1911115E50C9E8A94194E48DD0D09CFFB3ADCD2C1E92430903D07ADBF00532031575AA7F9E7B5A1F3362DEC936D4043C05F2476C07578BC9CBAF2AB4E382727AD41686A96B2548820BB03B32F11B2811AD62F489E951632ABA0D1DF89680CC8A8B53B481D92A68D70B4EA1C3A6A561C0692882B5CA8CC942A8D495AFCB06DE89498FB935B775908FE7A03E324D54CC19D4E1AABD3593B38B19EE1388FE492B43127E5A504253786A0D69AD32601C28E2C88504A5BA599706023A61363E17C6B9BB59BDC697452CD059451983D738CA3FD034E3F5988854CA05031DB09611498988197C6B30D258DFE26265541C89A4B31D6864E9389B03CB74F7EC4323FB9421A4B9790A26D17B0398A26767350909F84D57B6694DF830664CA8B3C3C03ED2AE67B89006868A68527CCD666459AB7F056671000C6164D3A7F266A14D97CBD7004D6C92CACA770B844A4FA9B182E7B18CA885082AC5646FCB4A14E1685FEB0C9CE3372AB95365C04FD83084F80A23FF10A05BF15F7FA5ACC6C0CB462C33CA524FA6B8BB359043BA68609EAA2536E81D08463B19653B5435BA946C9ADDEB202B04B031CC960DCC12E4518D428B32B257A4FC7313D3A7980D80082E934F9D95C32B0A0191A23604384DD9E079BBBAA266D14C3F756B9F2133107433A4E83FA7187282A809203A4FAF841851833D121AC383843A5E55BC2381425E16C7DB4CC9AB5C1B0D91A47E2B8DE0E582C86B6B0D907BB360B97F40AB5D038F6B75C814B27D9B968D419832BC8C2BEE605EF6E5059D33100D90485D378450014221736C07407CAC260408AA64926619788B8601C2A752D1A6CBF820D7C7A04716203225B3895B9342D147A8185CFC1BB65BA06B4142339903C0AC4651385B45D98A8B19D28CD6BAB088787F7EE1B12461766B43CBCCB96434427D93C065550688F6948ED1B5475A425F1B85209D061C08B56C1CC069F6C0A7C6F29358CAB911087732A649D27C9B98F9A48879387D9B00C25959A71654D6F6A946164513E47A75D005986C2363C09F6B537ECA78B9303A5FA457608A586A653A347DB04DFCC19175B3A301172536062A658A95277570C8852CA8973F4AE123A334047DD711C8927A634A03388A527B034BF7A8170FA702C1F7C23EC32D18A2374890BE9C787A9409C82D192C4BB705A2F996CE405DA72C2D9C843EE9F8313ECC7F86D6294D59159D9A879A542E260922ADF999051CC45200C9FFDB60449C49465979272367C083A7D6267A3ED7A7FD47957C219327F7CA73A4007E1627F00B11CC80573C15AEE6640FB8562DFA6B240CA0AD351AC4AC155B96C14C8AB13DD262CDFD51C4BB5572FD616553D17BDD430ACBEA3E95F0B698D66990AB51E5D03783A8B3D278A5720454CF9695CFDCA08485BA099C51CD92A7EA7587C1D15C28E609A81852601B0604010679AA482D51261EC36E36B8719676217FD74C54786488F4B4969C05A8BA27CA3A77CCE73B965923CA554E422B9B61F4754641608AC16C9B8587A32C1C5DD788F88B36B717A46965635DEB67F45B129B99070909C93EB80B42C2B3F3F70343A7CF37E8520E7BCFC416ACA4F18C7981262BA2BFC756AE03278F0EC66DC2057696824BA6769865A601D7148EF6F54E5AF5686AA2906F994CE38A5E0B938F239007003022C03392DF3401B1E4A3A7EBC6161449F73374C8B0140369343D9295FDF511845C4A46EBAAB6CA5492F6800B98C0CC803653A4B1D6E6AAED1932BACC5FEFAA818BA502859BA5494C5F5402C8536A9C4C1888150617F80098F6B2A99C39BC5DC7CF3B5900A21329AB59053ABAA64ED163E859A8B3B3CA3359B750CCC3E710C7AC43C8191CB5D68870C06391C0CB8AEC72B897AC6BE7FBAACC676ED66314C83630E89448C88A1DF04ACEB23ABF2E409EF333C622289C18A2134E650C45257E47475FA33AA537A5A8F7680214716C50D470E3284963CA64F54677AEC54B5272162BF52BC8142E1D4183FC017454A6B5A496831759064024745978CBD51A6CEDC8955DE4CC6D363670A47466E82BE5C23603A17BF22ACDB7CC984AF08C87E14E27753CF587A8EC3447E62C649E887A67C36C9CE98721B697213275646B194F36758673A8ED11284455AFC7A8529F69C97A3C2D7B8C636C0BA55614B768E624E712930F776169B01715725351BC74B47395ED52B25A1313C95164814C34C979CBDFAB85954662CAB485E75087A98CC74BB82CA2D1B5BF2803238480638C40E90B43C7460E7AA917F010151FAB1169987B372ABB59271F7006C24E60236B84B9DDD600623704254617FB498D89E58B0368BCB2103E79353EB587860C1422E476162E425BC2381DB82C6592737E1DD602864B0167A71EC1F223305C02FE25052AF2B3B5A55A0D7A2022D9A798DC0C5874A98702AAF4054C5D80338A5248B5B7BD09C53B5E2A084B047D277A861B1A73BB51488DE04EF573C85230A0470B73175C9FA50594F66A5F50B4150054C93B68186F8B5CBC49316C8548A642B2B36A1D454C7489AC33B2D2CE6668096782A2C1E0866D21A65E16B585E7AF8618BDF3184C1986878508917277B93E10706B1614972B2A94C7310FE9C708C231A1A8AC8D9314A529A97F469BF64962D820648443099A076D55D4CEA824A58304844F99497C10A25148618A315D72CA857D1B04D575B94F85C01D19BEF211BF0AA3362E7041FD16596D808E867B44C4C00D1CDA3418967717F147D0EB21B42AAEE74AC35D0B92414B958531AADF463EC6305AE5ECAF79174002F26DDECC813BF32672E8529D95A4E730A7AB4A3E8F8A8AF979A665EAFD465FC64A0C5F8F3F9003489415899D59A543D8208C54A3166529B53922D4EC143B50F01423B177895EDEE22BB739F647ECF85F50BC25EF7B5A725DEE868626ED79D451140800E03B59B956F8210E556067407D13DC90FA9E8B872BFB8F";
char *ct_s =
		"B52C56B92A4B7CE9E4CB7C5B1B163167A8A1675B2FDEF84A5B67CA15DB694C9F11BD027C30AE22EC921A1D911599AF0585E48D20DA70DF9F39E32EF95D4C8F44BFEFDAA5DA64F1054631D04D6D3CFD0A540DD7BA3886E4B5F13E878788604C95C096EAB3919F427521419A946C26CC041475D7124CDC01D0373E5B09C7A70603CFDB4FB3405023F2264DC3F983C4FC02A2D1B268F2208A1F6E2A6209BFF12F6F465F0B069C3A7F84F606D8A94064003D6EC114C8E808D3053884C1D5A142FBF20112EB360FDA3F0F28B172AE50F5E7D83801FB3F0064B687187074BD7FE30EDDAA334CF8FC04FA8CED899CEADE4B4F28B68372BAF98FF482A415B731155B75CEB976BE0EA0285BA01A27F1857A8FB377A3AE0C23B2AA9A079BFABFF0D5B2F1CD9B718BEA03C42F343A39B4F142D01AD8ACBB50E38853CF9A50C8B44C3CF671A4A9043B26DDBB24959AD6715C08521855C79A23B9C3D6471749C40725BDD5C2776D43AED20204BAA141EFB3304917474B7F9F7A4B08B1A93DAED98C67495359D37D67F7438BEE5E43585634B26C6B3810D7CDCBC0F6EB877A6087E68ACB8480D3A8CF6900447E49B417F15A53B607A0E216B855970D37406870B4568722DA77A4084703816784E2F16BED18996532C5D8B7F5D214464E5F3F6E905867B0CE119E252A66713253544685D208E1723908A0CE97834652E08AE7BDC881A131B73C71E84D20D68FDEFF4F5D70CD1AF57B78E3491A9865942321800A203C05ED1FEEB5A28E584E19F6535E7F84E4A24F84A72DCAF5648B4A4235DD664464482F03176E888C28BFC6C1CB238CFFA35A321E71791D9EA8ED0878C61121BF8D2A4AB2C1A5E120BC40ABB1892D1715090A0EE48252CA297A99AA0E510CF26B1ADD06CA543E1C5D6BDCD3B9C585C8538045DB5C252EC3C8C3C954D9BE5907094A894E60EAB43538CFEE82E8FFC0791B0D0F43AC1627830A61D56DAD96C62958B0DE780B78BD47A604550DAB83FFF227C324049471F35248CFB849B25724FF704D5277AA352D550958BE3B237DFF473EC2ADBAEA48CA2658AEFCC77BBD4264AB374D70EAE5B964416CE8226A7E3255A0F8D7E2ADCA062BCD6D78D60D1B32E11405BE54B66EF0FDDD567702A3BCCFEDE3C584701269ED14809F06F8968356BB9267FE86E514252E88BB5C30A7ECB3D0E621021EE0FBF7871B09342BF84F55C97EAF86C48189C7FF4DF389F077E2806E5FA73B3E9458A16C7E275F4F602275580EB7B7135FB537FA0CD95D6EA58C108CD8943D70C1643111F4F01CA8A8276A902666ED81B78D168B006F16AAA3D8E4CE4F4D0FB0997E41AEFFB5B3DAA838732F357349447F387776C793C0479DE9E99498CC356FDB0075A703F23C55D47B550EC89B02ADE89329086A50843456FEDC3788AC8D97233C54560467EE1D0F024B18428F0D73B30E19F5C63B9ABF11415BEA4D0170130BAABD33C05E6524E5FB5581B22B0433342248266D0F1053B245CC2462DC44D34965102482A8ED9E4E964D5683E5D45D0C8269";
char *ss_s = "914CB67FE5C38E73BF74181C0AC50428DEDF7750A98058F7D536708774535B29";

int HexStringToBytes(const char *hexStr, unsigned char *output,
		unsigned int *outputLen) {
	size_t len = strlen(hexStr);
	if (len % 2 != 0) {
		return -1;
	}
	size_t finalLen = len / 2;
	*outputLen = finalLen;
	for (size_t inIdx = 0, outIdx = 0; outIdx < finalLen;
			inIdx += 2, outIdx++) {
		if ((hexStr[inIdx] - 48) <= 9 && (hexStr[inIdx + 1] - 48) <= 9) {
			goto convert;
		} else {
			if ((hexStr[inIdx] - 65) <= 5 && (hexStr[inIdx + 1] - 65) <= 5) {
				goto convert;
			} else {
				*outputLen = 0;
				return -1;
			}
		}
		convert: output[outIdx] = (hexStr[inIdx] % 32 + 9) % 25 * 16
				+ (hexStr[inIdx + 1] % 32 + 9) % 25;
	}
	output[finalLen] = '\0';
	return 0;
}

void kyber768_kat() {
	unsigned int verb = 3;
// ---- MLKEM-768 ---- //
	unsigned char *pk_768;
	unsigned char *sk_768;
	unsigned char *correct_ss;
	pk_768 = malloc(1184);
	sk_768 = malloc(2400);
	correct_ss = malloc(32);

	unsigned int outputLen = 0;
	HexStringToBytes(pk_s, pk_768, &outputLen);
	HexStringToBytes(sk_s, sk_768, &outputLen);
	HexStringToBytes(ss_s, correct_ss, &outputLen);

	//mlkem768_genkeys_hw(pk_768, sk_768, interface);

	if (verb >= 3) {
		printf("\n public key: ");
		show_array(pk_768, 1184, 32);
	}
	if (verb >= 3) {
		printf("\n private key: ");
		show_array(sk_768, 2400, 32);
	}

	unsigned char ss[32];
	unsigned char *ct_768;
	ct_768 = malloc(1088);
	HexStringToBytes(ct_s, ct_768, &outputLen);

	//mlkem768_enc_hw(pk_768, ct_768, ss, 0);

	if (verb >= 2) {
		printf("\n ct: ");
		show_array(ct_768, 1088, 32);
	}

	if (verb >= 1) {
		printf("\n SS KAT: ");
		show_array(correct_ss, 32, 32);
	}
	unsigned char ss_sw[32];
	unsigned char ss_hw[32];

	unsigned int result = 0;

	mlkem768_dec_hw(sk_768, ct_768, ss_hw, &result, 0);
	print_result_valid("MLKEM-768-HW", result);
	MLKEM_768_DEC(ss_sw, ct_768, sk_768, &result);
	print_result_valid("MLKEM-768-SW", result);

	if (verb >= 1) {
		printf("\n SS KAT: ");
		show_array(correct_ss, 32, 32);
	}

	if (verb >= 1) {
		printf("\n SS HW: ");
		show_array(ss_hw, 32, 32);
	}

	if (verb >= 1) {
		printf("\n SS SW: ");
		show_array(ss_sw, 32, 32);
	}

	free(sk_768);
	free(pk_768);
	free(ct_768);
}

void demo_mlkem_hw(unsigned int mode, unsigned int verb, INTF interface) {

#ifdef AXI
    unsigned int clk_index = 0;
    float clk_frequency;
    float set_clk_frequency = FREQ_MLKEM;
    Set_Clk_Freq(clk_index, &clk_frequency, &set_clk_frequency, (int)verb);
#endif

    if (mode == 512) {
            // ---- MLKEM-512 ---- //
            unsigned char *pk_512;
    		unsigned char *sk_512;

    		pk_512 = malloc(800);
    		sk_512 = malloc(1632);

    		mlkem512_genkeys_hw(pk_512, sk_512, interface);

            if (verb >= 3) printf("\n pub_len: %d (bytes)", 800);
            if (verb >= 3) printf("\n pri_len: %d (bytes)", 1632);

            if (verb >= 3) { printf("\n public key: ");     show_array(pk_512, 800, 32); }
            if (verb >= 3) { printf("\n private key: ");    show_array(sk_512, 1632, 32); }

            unsigned char ss[32];
    		unsigned char *ct_512;
    		ct_512 = malloc(768);

    		mlkem512_enc_hw(pk_512, ct_512, ss, interface);

            if (verb >= 3) printf("\n ss_len: %d (bytes)", 32);
            if (verb >= 3) printf("\n ct_len: %d (bytes)", 768);

            if (verb >= 1) { printf("\n ss: ");    show_array(ss, 32, 32); }
            if (verb >= 3) { printf("\n ct: ");    show_array(ct_512, 768, 32); }

            unsigned char ss1[32];
    		unsigned int result;

    		mlkem512_dec_hw(sk_512, ct_512, ss1, &result, interface);

            if (verb >= 3) printf("\n ss1_len: %d (bytes)", 32);
            if (verb >= 1) { printf("\n ss1: ");    show_array(ss1, 32, 32); }

            print_result_valid("MLKEM-512", !(result >> 1)); // 01: bad result; 11: good result

            free(sk_512);
    		free(pk_512);
    		free(ct_512);

        }
        else if (mode == 768) {
            // ---- MLKEM-768 ---- //
            unsigned char* pk_768;
    		unsigned char* sk_768;

    		pk_768 = malloc(1184);
    		sk_768 = malloc(2400);

    		mlkem768_genkeys_hw(pk_768, sk_768, interface);

            if (verb >= 3) printf("\n pub_len: %d (bytes)", 1184);
            if (verb >= 3) printf("\n pri_len: %d (bytes)", 2400);

            if (verb >= 3) { printf("\n public key: ");     show_array(pk_768, 1184, 32); }
            if (verb >= 3) { printf("\n private key: ");    show_array(sk_768, 2400, 32); }

            unsigned char ss[32];
    		unsigned char* ct_768;
    		ct_768 = malloc(1088);

    		mlkem768_enc_hw(pk_768, ct_768, ss, interface);

            if (verb >= 3) printf("\n ss_len: %d (bytes)", 32);
            if (verb >= 3) printf("\n ct_len: %d (bytes)", 1088);

            if (verb >= 1) { printf("\n ss: ");    show_array(ss, 32, 32); }
            if (verb >= 3) { printf("\n ct: ");    show_array(ct_768, 1088, 32); }

            unsigned char ss1[32];
    		unsigned int result = 0;

    		mlkem768_dec_hw(sk_768, ct_768, ss1, &result, interface);

            if (verb >= 3) printf("\n ss1_len: %d (bytes)", 32);
            if (verb >= 1) { printf("\n ss1: ");    show_array(ss1, 32, 32); }

            print_result_valid("MLKEM-768", !(result >> 1)); // 01: bad result; 11: good result

            free(sk_768);
    		free(pk_768);
    		free(ct_768);

        }
        else {
            // ---- MLKEM-1024 ---- //
            unsigned char* pk_1024;
    		unsigned char* sk_1024;

    		pk_1024 = malloc(1568);
    		sk_1024 = malloc(3168);

    		mlkem1024_genkeys_hw(pk_1024, sk_1024, interface);

            if (verb >= 3) printf("\n pub_len: %d (bytes)", 1568);
            if (verb >= 3) printf("\n pri_len: %d (bytes)", 3168);

            if (verb >= 3) { printf("\n public key: ");     show_array(pk_1024, 1568, 32); }
            if (verb >= 3) { printf("\n private key: ");    show_array(sk_1024, 3168, 32); }

            unsigned char ss[32];
    		unsigned char* ct_1024;
    		ct_1024 = malloc(1568);

    		mlkem1024_enc_hw(pk_1024, ct_1024, ss, interface);

            if (verb >= 3) printf("\n ss_len: %d (bytes)", 32);
            if (verb >= 3) printf("\n ct_len: %d (bytes)", 1568);

            if (verb >= 1) { printf("\n ss: ");    show_array(ss, 32, 32); }
            if (verb >= 3) { printf("\n ct: ");    show_array(ct_1024, 1568, 32); }

            unsigned char ss1[32];
    		unsigned int result = 0;

    		mlkem1024_dec_hw(sk_1024, ct_1024, ss1, &result, interface);

            if (verb >= 3) printf("\n ss1_len: %d (bytes)", 32);
            if (verb >= 1) { printf("\n ss1: ");    show_array(ss1, 32, 32); }

            print_result_valid("MLKEM-1024", !(result >> 1)); // 01: bad result; 11: good result

            free(sk_1024);
    		free(pk_1024);
    		free(ct_1024);

        }

#ifdef AXI
    set_clk_frequency = FREQ_TYPICAL;
    Set_Clk_Freq(clk_index, &clk_frequency, &set_clk_frequency, (int)verb);
#endif

}
